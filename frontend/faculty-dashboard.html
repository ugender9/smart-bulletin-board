<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Faculty Dashboard - Smart Bulletin Board</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f5f5f5; }
        .navbar { background: #34495e; color: white; padding: 15px 30px; display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 20px; font-weight: bold; }
        .logout-btn { background: #e74c3c; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; }
        .container { max-width: 1000px; margin: 20px auto; padding: 20px; }
        .section { background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; font-weight: bold; margin-bottom: 8px; color: #2c3e50; }
        .form-group input, .form-group textarea, .form-group select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-family: inherit; }
        .submit-btn { background: #27ae60; color: white; padding: 12px 20px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; font-weight: bold; }
        .submit-btn:hover { background: #229954; }
        .notice-item { background: #f9f9f9; padding: 15px; border-left: 4px solid #27ae60; margin-bottom: 10px; border-radius: 4px; }
        .notice-title { font-weight: bold; color: #2c3e50; font-size: 16px; }
        .delete-btn { background: #e74c3c; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer; font-size: 12px; }
        .success-msg { background: #d4edda; color: #155724; padding: 12px; border-radius: 4px; margin-bottom: 15px; }
        .error-msg { background: #f8d7da; color: #721c24; padding: 12px; border-radius: 4px; margin-bottom: 15px; }
    </style>
</head>
<body>
    <div class="navbar">
        <div class="logo">üìö Smart Bulletin Board - Faculty</div>
        <button class="logout-btn" onclick="handleLogout()">Logout</button>
    </div>

    <div class="container">
        <h1 style="margin-bottom: 20px; color: #2c3e50;">Faculty Dashboard</h1>
        
        <div id="message"></div>

        <div class="section">
            <h2 style="margin-bottom: 15px; color: #34495e;">üìù Post New Notice</h2>
            <form id="noticeForm" onsubmit="handlePostNotice(event)">
                <div class="form-group">
                    <label>Notice Title</label>
                    <input type="text" id="title" required placeholder="e.g., CS201 Exam Schedule">
                </div>
                <div class="form-group">
                    <label>Content</label>
                    <textarea id="content" required rows="5" placeholder="Enter notice details..."></textarea>
                </div>
                <div class="form-group">
                    <label>Category</label>
                    <select id="category" required>
                        <option>Academic</option>
                        <option>Event</option>
                        <option>Deadline</option>
                        <option>Opportunity</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Department</label>
                    <select id="department" required>
                        <option>CSE</option>
                        <option>ECE</option>
                        <option>MECH</option>
                        <option>CIVIL</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Importance</label>
                    <select id="importance" required>
                        <option>Low</option>
                        <option>Medium</option>
                        <option>High</option>
                    </select>
                </div>
                <button type="submit" class="submit-btn">Post Notice</button>
            </form>
        </div>

        <div class="section">
            <h2 style="margin-bottom: 15px; color: #34495e;">Your Posted Notices</h2>
            <div id="noticesList">Loading...</div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.0.0/firebase-app.js';
        import { getAuth, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/11.0.0/firebase-auth.js';
        import { getFirestore, collection, addDoc, query, where, getDocs, deleteDoc, doc, serverTimestamp } from 'https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyAnz7rG5VmOo-4xCixTTFETGjHStEzptqA",
            authDomain: "techsprint-smartboard-d0a55.firebaseapp.com",
            projectId: "techsprint-smartboard-d0a55",
            storageBucket: "techsprint-smartboard-d0a55.firebasestorage.app",
            messagingSenderId: "437326267964",
            appId: "1:437326267964:web:c70536d8ec8d3abecae539"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        window.auth = auth;
        window.db = db;
        window.signOut = signOut;
        window.onAuthStateChanged = onAuthStateChanged;
        window.collection = collection;
        window.addDoc = addDoc;
        window.query = query;
        window.where = where;
        window.getDocs = getDocs;
        window.deleteDoc = deleteDoc;
        window.doc = doc;
        window.serverTimestamp = serverTimestamp;
    </script>

    <script>
        let currentUser = null;

        window.onAuthStateChanged(window.auth, async (user) => {
            if (!user) {
                window.location.href = '/index.html';
                return;
            }
            currentUser = user;
            loadFacultyNotices();
        });

        async function handlePostNotice(event) {
            event.preventDefault();
            const messageDiv = document.getElementById('message');

            try {
                const title = document.getElementById('title').value;
                const content = document.getElementById('content').value;
                const category = document.getElementById('category').value;
                const department = document.getElementById('department').value;
                const importance = document.getElementById('importance').value;

                const noticesRef = window.collection(window.db, 'notices');
                await window.addDoc(noticesRef, {
                    title,
                    content,
                    category,
                    department,
                    importance,
                    postedBy: currentUser.email,
                    facultyId: currentUser.uid,
                    timestamp: window.serverTimestamp()
                });

                messageDiv.className = 'success-msg';
                messageDiv.textContent = '‚úÖ Notice posted successfully!';
                document.getElementById('noticeForm').reset();
                setTimeout(() => {
                    messageDiv.textContent = '';
                    loadFacultyNotices();
                }, 2000);
            } catch (error) {
                messageDiv.className = 'error-msg';
                messageDiv.textContent = '‚ùå Error: ' + error.message;
            }
        }

        async function loadFacultyNotices() {
            try {
                const noticesRef = window.collection(window.db, 'notices');
                const q = window.query(noticesRef, window.where('facultyId', '==', currentUser.uid));
                const querySnapshot = await window.getDocs(q);

                let html = '';
                if (querySnapshot.empty) {
                    html = '<p style="color: #7f8c8d;">No notices posted yet</p>';
                } else {
                    querySnapshot.forEach((doc) => {
                        const data = doc.data();
                        html += `
                            <div class="notice-item">
                                <div class="notice-title">${data.title}</div>
                                <p style="color: #555; margin: 8px 0; font-size: 14px;">${data.content}</p>
                                <div style="font-size: 12px; color: #7f8c8d; margin-bottom: 10px;">
                                    Category: ${data.category} | Dept: ${data.department} | Importance: ${data.importance}
                                </div>
                                <button class="delete-btn" onclick="deleteNotice('${doc.id}')">Delete</button>
                            </div>
                        `;
                    });
                }
                document.getElementById('noticesList').innerHTML = html;
            } catch (error) {
                document.getElementById('noticesList').innerHTML = '<p style="color: #e74c3c;">Error loading notices: ' + error.message + '</p>';
            }
        }

        async function deleteNotice(noticeId) {
            if (!confirm('Are you sure you want to delete this notice?')) return;
            try {
                await window.deleteDoc(window.doc(window.db, 'notices', noticeId));
                loadFacultyNotices();
            } catch (error) {
                alert('Error deleting notice: ' + error.message);
            }
        }

        async function handleLogout() {
            try {
                await window.signOut(window.auth);
                localStorage.clear();
                window.location.href = '/index.html';
            } catch (error) {
                alert('Error logging out: ' + error.message);
            }
        }
    </script>
</body>
</html>
